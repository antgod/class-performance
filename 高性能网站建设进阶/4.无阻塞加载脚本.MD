1.脚本阻塞并行下载

    下载与运行js会阻塞页面运行,所以我们需要在onload后按需无阻塞加载js.

2.无阻塞加载js

    1. xhr:eval

        //需要跨域,并且效率较低
        eval(xhrObj.responseText)

    2. xhr注入

        //需要跨域,比eval效率高一些
        var script = document.createElement('script');
        document.documentElement.appendChild(script);
        script.text=xhrObj.responseText;

    3. script in frame

        //iframe不会阻塞当前窗体的代码执行
        var jsurl='http://xxx/a.js';
        window.frames[0].createDiv(jsurl);

        function createDiv(jsurl){
           var script = parent.document.createElement('script');
           script.src=jsurl;
           parent.document.body.appendChild(script);
        }

    4. script dom element

        var jsurl='http://xxx/a.js';
        //允许跨域,实现代码短小简单,容易修改,不阻塞其他代码运行,是比较常见方式
        var script = document.createElement('script');
        document.documentElement.appendChild(script);
        script.text=jsurl;

    5. script defer

        //只有IE和一些浏览器支持,允许其他资源并行下载

    6. document.write script tag

        //虽然可以并行下载多个脚本,但是脚本下载时,仍然会阻塞其他资源

3. 浏览器致忙指示器

    浏览器title图标\光标与底部状态栏\进度条都会提示浏览器正在下载

4. JS下载触发浏览器忙指示器(F:firefox,S:safiri,C:chrome,I:IE,O:Opera)


技术|状态栏|进度条|图标|光标|阻塞渲染|阻塞onload
---|---
src|FSC|IFS|IFSC|FC|IFSCO|IFSCO
eval|SC|S|SC|SC|- -|- -
注入|SC|S|SC|SC|- -|- -
iframe|IFSC|FS|IFSC|FC|- -|IFSCO
domelement|FSC|FS|FSC|FC|- -|FSC
defer|FSC|FS|FSC|FCO|FSCO|IFSCO
write|FSC|IFS|IFSC|FCO|IFSCO|IFSCO




